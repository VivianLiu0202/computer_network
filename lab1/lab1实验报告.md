<h1><center>计算机网络实验报告</center></h1>

<h3><center>lab1:利用Socket编写一个聊天程序</center></h3>

<h5><center>2112614 刘心源</center></h5>

# 一、前期准备

### 实验环境

MacOS+Vscode



# 二、协议设计

##### 套接字：Socket

计算机网络中用于实现不同计算机间或同一计算机内的进程间通信的一种技术。它提供了一个标准的API接口，使得应用程序可以使用网络协议（如TCP/IP）进行通信。

###### 流式套接字：Stream Sockets

使用`TCP`（传输控制协议）进行通信，提供了一个可靠的、双向的、基于连接的字节流。这意味着数据按照发送的顺序到达，并且不会丢失或重复。



##### 网络协议

网络协议是一组预定义的规则和约定，用于控制计算机或其他网络设备在网络上的通信。这些规则确保了数据在发送和接收时的正确性、完整性和及时性。

###### 网络协议的三要素：

网络协议的三要素是描述和定义协议核心特性的三个基本组成部分：

1. **语法（Syntax）**:
   - 描述数据的结构和格式。
   - 定义如何组织和表示数据，例如数据包的头部和尾部、字段的长度、数据的编码方式等。
   - Tips：`IPv4`地址由四个字节组成，每个字节之间用点（.）分隔。
2. **语义（Semantics）**:
   - 描述数据的意义和解释。
   - 定义数据的操作、指示、命令和其他功能。
   - Tips：`HTTP`协议中的`GET`请求表示要从服务器检索信息，而`POST`请求表示要向服务器发送数据。
3. **时序（Timing）**:
   - 描述数据交换的顺序和时间要求。
   - 定义事件发生的顺序、数据包的发送和接收速率、超时和重试策略等。
   - Tips：`TCP`协议中的三次握手过程定义了建立连接的顺序和时间要求。



### 协议设计

在本聊天程序中，我们设计协议如下：

本程序实现一个多人聊天程序：

1. 使用流式套接字，使用多线程
2. 程序包括客户端与服务器端
3. 服务器端支持与客户端相连接
   - 设置最大连接数，当超过最大连接数时，服务器不支持连接；
   - 对于每个连接的客户端，服务器都会创建一个新的线程来处理该客户端的消息。
   - 服务器接收到客户端的消息后，将消息打上时间标签，并广播到所有其他已连接的客户端，每条消息在服务器端都会被记录到日志中。
   - 服务器实时检测与每个客户端的连接状态。如果发现某个客户端已断开连接，服务器会：
     - 立即回收与该客户端相关的所有资源；
     - 如果当前在线的客户端数量还没有达到上限，服务器将继续接受新客户端的连接请求。

4. 客户端与服务器端建立连接
   - 客户端使用两个线程：
     - 一个线程用于输入和发送消息
     - 一个线程用于接收服务器的消息并打印
   - 客户端实时检测是否与服务器建立连接，如果连接异常，例如由于网络问题或对方关闭连接，客户端会关闭相应的`SOCKET`并处理异常。
   - 客户端可以自行关闭：
     - 客户端可以输入`EXIT`或直接关闭程序来断开连接，关闭`SOCKET`。
5. 消息
   - 消息是文本格式，设置有最大长度，不允许输入超过最大长度的字符串；
   - 收发消息保存在字符数组类型的缓冲区中；
   - 消息以换行符结尾，允许在一条消息中输入空格；



